{% extends "base.html" %}
{% block content %}
<div class="auth-wrapper">
  <div class="auth-card">
    <h2 style="margin:0 0 0.5rem;">Reset your password</h2>
    <p style="margin:0 0 1rem;color:var(--muted);">Enter a new password for your TheoChat account.</p>
    <div style="max-width:420px;margin:0 auto;">
      <div style="padding:1.25rem;border:1px solid var(--border);border-radius:10px;background:var(--card);">
        {% if error %}
          <p style="margin:0 0 0.75rem;color:#b91c1c;font-size:0.95rem;">{{ error }}</p>
          <p style="margin:0;font-size:0.9rem;"><a href="{{ url_for('forgot_password') }}">Request a new reset link</a></p>
        {% elif token %}
          <form method="post" action="{{ url_for('reset_password') }}" style="margin:0;">
            <input type="hidden" name="token" value="{{ token }}"/>
            <label style="display:block;margin-bottom:0.85rem;font-size:0.95rem;">
              <span style="display:block;margin-bottom:0.35rem;">New password</span>
              <input type="password" name="password" id="password" required autocomplete="new-password" style="display:block;width:100%;padding:0.5rem;border-radius:6px;border:1px solid #d1d5db;"/>
              <div style="margin-top:0.4rem;">
                <div id="pw-strength-bar" style="height:6px;border-radius:6px;overflow:hidden;background:#e5e7eb;">
                  <div id="pw-strength-fill" style="height:100%;width:5%;background:#ef4444;"></div>
                </div>
                <div id="pw-strength-text" style="margin-top:0.35rem;font-size:0.8rem;color:#6b7280;">
                  Password strength: <span id="pw-strength-label">Too weak</span>
                </div>
                <div style="margin-top:0.25rem;font-size:0.78rem;color:#9ca3af;">
                  Must be at least 8 characters and include uppercase, lowercase, a number, and a special character.
                </div>
              </div>
              <div class="mt-3 text-xs text-gray-500" style="margin-top:0.75rem;font-size:0.82rem;color:#6b7280;">
                <div class="font-medium mb-1" style="font-weight:600;margin-bottom:0.35rem;">Password must include:</div>
                <ul class="space-y-1" style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:0.35rem;">
                  <li id="pw-rule-length" class="flex items-center gap-2" style="display:flex;align-items:center;gap:0.4rem;color:#6b7280;">
                    <span class="pw-rule-icon">✘</span>
                    <span>At least 8 characters</span>
                  </li>
                  <li id="pw-rule-upper" class="flex items-center gap-2" style="display:flex;align-items:center;gap:0.4rem;color:#6b7280;">
                    <span class="pw-rule-icon">✘</span>
                    <span>At least one uppercase letter (A–Z)</span>
                  </li>
                  <li id="pw-rule-lower" class="flex items-center gap-2" style="display:flex;align-items:center;gap:0.4rem;color:#6b7280;">
                    <span class="pw-rule-icon">✘</span>
                    <span>At least one lowercase letter (a–z)</span>
                  </li>
                  <li id="pw-rule-digit" class="flex items-center gap-2" style="display:flex;align-items:center;gap:0.4rem;color:#6b7280;">
                    <span class="pw-rule-icon">✘</span>
                    <span>At least one number (0–9)</span>
                  </li>
                  <li id="pw-rule-special" class="flex items-center gap-2" style="display:flex;align-items:center;gap:0.4rem;color:#6b7280;">
                    <span class="pw-rule-icon">✘</span>
                    <span>At least one special character (!@#$%^&amp;* etc.)</span>
                  </li>
                </ul>
              </div>
            </label>
            <label style="display:block;margin-bottom:0.85rem;font-size:0.95rem;">
              <span style="display:block;margin-bottom:0.35rem;">Confirm new password</span>
              <input
                type="password"
                name="confirm_password"
                id="confirm_password"
                required
                autocomplete="new-password"
                style="display:block;width:100%;padding:0.5rem;border-radius:6px;border:1px solid #d1d5db;"
              />
              <div id="pw-match-text" style="margin-top:0.35rem;font-size:0.8rem;color:#6b7280;">
              </div>
            </label>
            <div style="text-align:center;">
              <button class="primary" type="submit" style="padding:0.5rem 1rem;border-radius:6px;background:#2563eb;color:#fff;border:1px solid #2563eb;display:inline-block;">Reset password</button>
            </div>
          </form>
        {% else %}
          <p style="margin:0 0 0.75rem;color:#b91c1c;font-size:0.95rem;">This password reset link is invalid or has expired.</p>
          <p style="margin:0;font-size:0.9rem;"><a href="{{ url_for('forgot_password') }}">Request a new reset link</a></p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
<script src="{{ url_for('static', filename='js/password_strength.js') }}"></script>
{% endblock %}
