{% extends "base.html" %}
{% block content %}
<div class="tc-card max-w-md mx-auto">
  <div class="tc-form space-y-4">
    <div>
      <h1 class="tc-h1" style="margin-bottom:0.35rem;">Reset your password</h1>
      <p class="tc-subtext">Enter a new password for your TheoChat account.</p>
    </div>
    <div class="p-1">
      {% if error %}
        <p class="text-sm text-red-600 dark:text-red-400 mb-2">{{ error }}</p>
        <p class="text-sm"><a href="{{ url_for('forgot_password') }}" class="underline">Request a new reset link</a></p>
      {% elif token %}
        <form method="post" action="{{ url_for('reset_password') }}" class="space-y-4">
          <input type="hidden" name="token" value="{{ token }}"/>
          <div class="tc-field-row space-y-2">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200">
              <span class="mb-1 block">New password</span>
              <div class="password-wrapper tc-input-wrapper">
                <input type="password" name="password" id="password" required autocomplete="new-password" class="tc-input w-full" />
                <img src="{{ url_for('static', filename='img/eye-closed.svg') }}" class="password-eye tc-password-toggle" alt="Show password">
              </div>
              <div class="space-y-2 text-xs text-slate-500 dark:text-slate-400">
                <div id="pw-strength-bar" class="h-1.5 rounded-full overflow-hidden bg-slate-200 dark:bg-slate-800">
                  <div id="pw-strength-fill" style="height:100%;width:5%;background:#ef4444;"></div>
                </div>
                <div id="password-strength-text" class="text-slate-600 dark:text-slate-300 text-xs">
                  Password strength: <span id="password-strength-label">Too weak</span>
                </div>
                <div id="pw-traffic" class="pw-traffic">
                  <span class="pw-light" data-level="weak"></span>
                  <span class="pw-light" data-level="medium"></span>
                  <span class="pw-light" data-level="strong"></span>
                </div>
                <div class="text-[11px] text-slate-500 dark:text-slate-400 space-y-1">
                  <div class="font-semibold">Password must include:</div>
                  <ul id="password-rules" class="space-y-1 list-none m-0 p-0">
                    <li data-rule="length" class="flex items-center gap-2 text-slate-600 dark:text-slate-300"><span class="pw-rule-icon">-</span><span>At least 8 characters</span></li>
                    <li data-rule="upper" class="flex items-center gap-2 text-slate-600 dark:text-slate-300"><span class="pw-rule-icon">-</span><span>At least one uppercase letter (A-Z)</span></li>
                    <li data-rule="lower" class="flex items-center gap-2 text-slate-600 dark:text-slate-300"><span class="pw-rule-icon">-</span><span>At least one lowercase letter (a-z)</span></li>
                    <li data-rule="digit" class="flex items-center gap-2 text-slate-600 dark:text-slate-300"><span class="pw-rule-icon">-</span><span>At least one number (0-9)</span></li>
                    <li data-rule="special" class="flex items-center gap-2 text-slate-600 dark:text-slate-300"><span class="pw-rule-icon">-</span><span>At least one special character (!@#$%^&amp;* etc.)</span></li>
                  </ul>
                </div>
              </div>
            </label>
          </div>
        <div class="tc-field-row space-y-1">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-200">
              <span class="mb-1 block">Confirm new password</span>
              <div class="password-wrapper tc-input-wrapper">
                <input
                  type="password"
                  name="confirm_password"
                  id="confirm_password"
                  required
                  autocomplete="new-password"
                  class="tc-input w-full"
                />
                <img src="{{ url_for('static', filename='img/eye-closed.svg') }}" class="password-eye tc-password-toggle" alt="Show password">
              </div>
              <div id="pw-match-text" class="text-xs text-slate-600 dark:text-slate-400"></div>
            </label>
          </div>
          <div class="text-center">
            <button class="tc-btn-primary w-full justify-center" type="submit">Reset password</button>
          </div>
        </form>
      {% else %}
        <p class="text-sm text-red-600 dark:text-red-400 mb-2">Invalid or expired token.</p>
        <p class="text-sm"><a href="{{ url_for('forgot_password') }}" class="underline">Request a new reset link</a></p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
