{% extends "base.html" %}
{% block content %}
<div class="tc-card max-w-md mx-auto space-y-4">
  <div>
    <h1 class="tc-h1" style="margin-bottom:0.35rem;">Reset your password</h1>
    <p class="tc-subtext">Enter a new password for your TheoChat account.</p>
  </div>
  <div class="p-1">
    {% if error %}
      <p class="text-sm text-red-600 dark:text-red-400 mb-2">{{ error }}</p>
      <p class="text-sm"><a href="{{ url_for('forgot_password') }}" class="underline">Request a new reset link</a></p>
    {% elif token %}
      <form method="post" action="{{ url_for('reset_password') }}" class="space-y-4">
        <input type="hidden" name="token" value="{{ token }}"/>
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 space-y-2">
          <span class="mb-1 block">New password</span>
          <div class="password-wrapper">
            <input type="password" name="password" id="password" required autocomplete="new-password" class="w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500" />
            <img src="{{ url_for('static', filename='img/eye-closed.svg') }}" class="password-eye" alt="Show password">
          </div>
          <div class="space-y-2 text-xs text-slate-500 dark:text-slate-400">
            <div id="pw-strength-bar" class="h-1.5 rounded-full overflow-hidden bg-slate-200 dark:bg-slate-800">
              <div id="pw-strength-fill" style="height:100%;width:5%;background:#ef4444;"></div>
            </div>
            <div id="pw-strength-text" class="text-slate-600 dark:text-slate-300 text-xs">
              Password strength: <span id="pw-strength-label">Too weak</span>
            </div>
            <div class="text-[11px] text-slate-500 dark:text-slate-400">
              Must be at least 8 characters and include uppercase, lowercase, a number, and a special character.
            </div>
            <div class="text-[11px] text-slate-500 dark:text-slate-400 space-y-1">
              <div class="font-semibold">Password must include:</div>
              <ul class="space-y-1 list-none m-0 p-0">
                <li id="pw-rule-length" class="flex items-center gap-2 text-slate-600 dark:text-slate-300"><span class="pw-rule-icon">●</span><span>At least 8 characters</span></li>
                <li id="pw-rule-upper" class="flex items-center gap-2 text-slate-600 dark:text-slate-300"><span class="pw-rule-icon">●</span><span>At least one uppercase letter (A-Z)</span></li>
                <li id="pw-rule-lower" class="flex items-center gap-2 text-slate-600 dark:text-slate-300"><span class="pw-rule-icon">●</span><span>At least one lowercase letter (a-z)</span></li>
                <li id="pw-rule-digit" class="flex items-center gap-2 text-slate-600 dark:text-slate-300"><span class="pw-rule-icon">●</span><span>At least one number (0-9)</span></li>
                <li id="pw-rule-special" class="flex items-center gap-2 text-slate-600 dark:text-slate-300"><span class="pw-rule-icon">●</span><span>At least one special character (!@#$%^&amp;* etc.)</span></li>
              </ul>
            </div>
          </div>
        </label>
        <label class="block text-sm font-medium text-slate-700 dark:text-slate-200 space-y-1">
          <span class="mb-1 block">Confirm new password</span>
          <div class="password-wrapper">
            <input
              type="password"
              name="confirm_password"
              id="confirm_password"
              required
              autocomplete="new-password"
              class="w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"
            />
            <img src="{{ url_for('static', filename='img/eye-closed.svg') }}" class="password-eye" alt="Show password">
          </div>
          <div id="pw-match-text" class="text-xs text-slate-600 dark:text-slate-400"></div>
        </label>
        <div class="text-center">
          <button class="tc-btn-primary w-full justify-center" type="submit">Reset password</button>
        </div>
      </form>
    {% else %}
      <p class="text-sm text-red-600 dark:text-red-400 mb-2">This password reset link is invalid or has expired.</p>
      <p class="text-sm"><a href="{{ url_for('forgot_password') }}" class="underline">Request a new reset link</a></p>
    {% endif %}
  </div>
</div>
<script src="{{ url_for('static', filename='js/password_strength.js') }}"></script>
{% endblock %}
