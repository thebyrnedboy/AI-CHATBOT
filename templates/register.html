{% extends "base.html" %}
{% block content %}
<div class="auth-wrapper">
  <div class="auth-card">
    <h2 style="margin:0 0 0.5rem;">Create a TheoChat account</h2>
    <p style="margin:0 0 1rem;color:var(--muted);">Spin up your TheoChat workspace.</p>
    <div style="max-width:420px;margin:0 auto;">
      <div style="padding:1.25rem;border:1px solid var(--border);border-radius:10px;background:var(--card);">
        <form method="post" action="{{ url_for('register') }}" style="margin:0;">
          <label style="display:block;margin-bottom:0.85rem;font-size:0.95rem;">
            <span style="display:block;margin-bottom:0.35rem;">Email</span>
            <input type="email" name="email" required autocomplete="email" style="display:block;width:100%;padding:0.5rem;border-radius:6px;border:1px solid #d1d5db;"/>
          </label>
          <label style="display:block;margin-bottom:0.85rem;font-size:0.95rem;">
            <span style="display:block;margin-bottom:0.35rem;">Password</span>
            <input type="password" name="password" id="password" required autocomplete="new-password" style="display:block;width:100%;padding:0.5rem;border-radius:6px;border:1px solid #d1d5db;"/>
            <div style="margin-top:0.4rem;">
              <div id="pw-strength-bar" style="height:6px;border-radius:6px;overflow:hidden;background:#e5e7eb;">
                <div id="pw-strength-fill" style="height:100%;width:5%;background:#ef4444;"></div>
              </div>
              <div id="pw-strength-text" style="margin-top:0.35rem;font-size:0.8rem;color:#6b7280;">
                Password strength: <span id="pw-strength-label">Too weak</span>
              </div>
              <div style="margin-top:0.25rem;font-size:0.78rem;color:#9ca3af;">
                Must be at least 8 characters and include uppercase, lowercase, a number, and a special character.
              </div>
            </div>
            <div class="mt-3 text-xs text-gray-500" style="margin-top:0.75rem;font-size:0.82rem;color:#6b7280;">
              <div class="font-medium mb-1" style="font-weight:600;margin-bottom:0.35rem;">Password must include:</div>
              <ul class="space-y-1" style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:0.35rem;">
                <li id="pw-rule-length" class="flex items-center gap-2" style="display:flex;align-items:center;gap:0.4rem;color:#6b7280;">
                  <span class="pw-rule-icon">✘</span>
                  <span>At least 8 characters</span>
                </li>
                <li id="pw-rule-upper" class="flex items-center gap-2" style="display:flex;align-items:center;gap:0.4rem;color:#6b7280;">
                  <span class="pw-rule-icon">✘</span>
                  <span>At least one uppercase letter (A–Z)</span>
                </li>
                <li id="pw-rule-lower" class="flex items-center gap-2" style="display:flex;align-items:center;gap:0.4rem;color:#6b7280;">
                  <span class="pw-rule-icon">✘</span>
                  <span>At least one lowercase letter (a–z)</span>
                </li>
                <li id="pw-rule-digit" class="flex items-center gap-2" style="display:flex;align-items:center;gap:0.4rem;color:#6b7280;">
                  <span class="pw-rule-icon">✘</span>
                  <span>At least one number (0–9)</span>
                </li>
                <li id="pw-rule-special" class="flex items-center gap-2" style="display:flex;align-items:center;gap:0.4rem;color:#6b7280;">
                  <span class="pw-rule-icon">✘</span>
                  <span>At least one special character (!@#$%^&amp;* etc.)</span>
                </li>
              </ul>
            </div>
          </label>
          <div style="margin-top:0.75rem;margin-bottom:0.85rem;font-size:0.95rem;">
            <label for="confirm_password" style="display:block;margin-bottom:0.35rem;">Confirm password</label>
            <input
              type="password"
              name="confirm_password"
              id="confirm_password"
              required
              autocomplete="new-password"
              style="display:block;width:100%;padding:0.5rem;border-radius:6px;border:1px solid #d1d5db;"
            />
            <div id="pw-match-text" style="margin-top:0.35rem;font-size:0.8rem;color:#6b7280;">
            </div>
          </div>
          <div style="text-align:center;">
            <button class="primary" type="submit" style="padding:0.5rem 1rem;border-radius:6px;background:#2563eb;color:#fff;border:1px solid #2563eb;display:inline-block;">Create account</button>
          </div>
        </form>
        <p style="margin:0.9rem 0 0;font-size:0.9rem;color:var(--muted);text-align:center;">
          Already have an account? <a href="{{ url_for('login') }}">Log in</a>
        </p>
      </div>
    </div>
  </div>
</div>
<script>
  (function() {
    const bar = document.getElementById("pw-strength-bar");
    if (bar) {
      const styleTag = document.createElement("style");
      styleTag.textContent = "body.dark #pw-strength-bar { background: #111827; }";
      document.head.appendChild(styleTag);
    }
    const pwInput = document.getElementById("password");
    const pwConfirm = document.getElementById("confirm_password");
    const matchText = document.getElementById("pw-match-text");
    const strengthFill = document.getElementById("pw-strength-fill");
    const strengthLabel = document.getElementById("pw-strength-label");

    const ruleLength = document.getElementById("pw-rule-length");
    const ruleUpper = document.getElementById("pw-rule-upper");
    const ruleLower = document.getElementById("pw-rule-lower");
    const ruleDigit = document.getElementById("pw-rule-digit");
    const ruleSpecial = document.getElementById("pw-rule-special");

    function setRuleState(el, ok) {
      if (!el) return;
      const icon = el.querySelector(".pw-rule-icon");
      // Set colour directly so inline styles don’t fight CSS classes
      el.style.color = ok ? "#22c55e" : "#6b7280";
      if (icon) {
        icon.textContent = ok ? "✓" : "✘";
      }
    }

    function evaluatePassword(pw) {
      const hasLength = pw.length >= 8;
      const hasUpper = /[A-Z]/.test(pw);
      const hasLower = /[a-z]/.test(pw);
      const hasDigit = /[0-9]/.test(pw);
      const hasSpecial = /[^A-Za-z0-9]/.test(pw);

      let score = 0;
      if (hasLength) score++;
      if (hasUpper) score++;
      if (hasLower) score++;
      if (hasDigit) score++;
      if (hasSpecial) score++;

      let level, width, color;
      if (!pw) {
        level = "Too weak";
        width = "5%";
        color = "#ef4444"; // red
      } else if (score <= 2) {
        level = "Weak";
        width = "25%";
        color = "#ef4444";
      } else if (score === 3 || score === 4) {
        level = "Medium";
        width = "60%";
        color = "#f59e0b"; // amber
      } else {
        level = "Strong";
        width = "100%";
        color = "#22c55e"; // green
      }

      return {
        hasLength,
        hasUpper,
        hasLower,
        hasDigit,
        hasSpecial,
        level,
        width,
        color,
      };
    }

    function updateStrength() {
      if (!pwInput) return;
      const pw = pwInput.value || "";
      const result = evaluatePassword(pw);

      if (strengthFill) {
        strengthFill.style.width = result.width;
        strengthFill.style.backgroundColor = result.color;
      }
      if (strengthLabel) {
        strengthLabel.textContent = result.level;
      }

      setRuleState(ruleLength, result.hasLength);
      setRuleState(ruleUpper, result.hasUpper);
      setRuleState(ruleLower, result.hasLower);
      setRuleState(ruleDigit, result.hasDigit);
      setRuleState(ruleSpecial, result.hasSpecial);
    }

    function checkMatch() {
      if (!pwInput || !pwConfirm || !matchText) return;
      if (!pwInput.value && !pwConfirm.value) {
        matchText.textContent = "";
        return;
      }
      if (pwInput.value === pwConfirm.value) {
        matchText.textContent = "Passwords match ✓";
        matchText.style.color = "#22c55e";
      } else {
        matchText.textContent = "Passwords do not match";
        matchText.style.color = "#ef4444";
      }
    }

    if (pwInput) {
      pwInput.addEventListener("input", function () {
        updateStrength();
        checkMatch();
      });
    }
    if (pwConfirm) {
      pwConfirm.addEventListener("input", checkMatch);
    }
    updateStrength();
    checkMatch();
  })();
</script>
{% endblock %}
